-*- text -*-
TODO list for M
$Id$

*********************************************************************
*** Plans for the next release:
*********************************************************************

** These are the main topics planned for the next release(s):

- completion of filtering rules/scoring code
- subscription management for NNTP/IMAP/newsspool
- DND with KDE/Gnome filemanagers (now supported by wxGTK)
- Finish the new message editor code: selections, cut&paste,
  rich-text editing
- Templates/style-sheets for message composition and flexible reply
  handling 
- Windows version release (End of May?)
- Messages sorting, threading, scoring and searching

** Possibly that one or the release after that:
 
- multi-threading to avoid delays and timeouts
- GPG/PGP support?
- built-in HTML viewer

GENERAL ROADMAP/ORDER OF THINGS:

  1. finish message editor/viewer improvements
  2. fix remaining bugs in Windows version  ---> make new common release
  3. finish filtering code
  4. do multi-threading before adding sorting etc

2/3/4 will happen in parallel as 2 is done by VZ and 3/4 by KB, 4 will 
happen on a separate cvs branch to avoid breaking the stable release
code. Some of the minor topics from the list above will happen as they 
fit in (DND, templates, etc).


*********************************************************************
*** Currently being worked on:
***   (This section is a bit of a mess as it is our day to day
***    noticeboard where we list whatever comes to our mind.)
*********************************************************************

wxGTK bug:
 - wxTreeCtrl::HitTest() doesn't work well with non standard icon sizes
 - strange WM hints on fvwm95/alpha

wxMSW bugs:
 - memory leaks (some from cclient, others - not sure)
 - radiobox doesn't respect constraints, adjusts its size as it thinks is better
 - in folder create/properties dialog there is missing UpdateUI() right
   after creation - add it somewhere
 - lock file checking for INBOX:
   + it does locking under Windows too, but the lock file names are different
     Testing for FOLDER.lock* now, is that fine?
 - wxLayout completely broken:
   + scrollbars are not updated nor even drawn at all
   + vertical and horizontal lines across the window
   + some areas are duplicated (displayed twice with some small shift)
   + ...
 - CR/LF problems when replying to the messages

VZ:
- wxConfig does not like entries like:
  Key=Value
  but insists on
  Key = Value

- Initially selected folder is not highlighted in treectrl.

- help button for first folder create page nees a help id
  KB: couldn't even find out where you create the button :-(
- when user level is >=1 (advanced) show full preferences pages in
  folder notbook

- If any top level window is open (messageview/composeview), the
  application will not exit. Happened after you changed the exit
  behaviour, has been a bug for months.
    VZ: can't reproduce this

- closing splashscreen calls wxApp::ExitMainLoop() which is wrong!
  VZ: can't reproduce this
  KB: only if no other window is open

- foldertreectrl in folder selection dialog should have keyboard focus 
  and should not open folder when pressed return, but select it :-)

- Would it be possible to set the icon in the treectrl on a per-folder 
  basis? I'd like to read the iconname from the folder profile, that
  would allow nice things such as a "trash/junk" folder, etc.


******* Priorities for KB: ******************************

- when sending message failed, don't make it readonly but rebuild it
  after editing
- change main frame icon when new mail in mainframe folder
- searching in messageview
- more configurability for news
- do we really need to scan /var/lib/news/active?
- add address auto collection to compose view
- add a popup dialog to edit message headers in composeview
- some html mail import/filtering of tags (easy, quick and dirty)
- Change MessageCC code to first look for a mail cache entry via
  mail_elt() instead of always fetching message. (REALLY REQUIRED?)
  Is already like this, but fetch_overview() does an extra fetch, even
  in mtest.
  STRANGE....
- Problem: mail uids and nums are long, WXARRAYINT.Count() is int,
  content is int.
- MFolderDialog: TransferFromWindow return false ignored when asked
  for password
= wxLayout:
  - fix horiz scrollbar size
  - update rectangle (needs support in wxllist and wxWindows)
  - fix(simplify) cursor size calculation
  - font optimisations(!)
  - copy/cut/selections
  - occasionally wraps lines wongly (twice) (fixed now?)
  - UNDO
  later:
    - DragNDrop (waiting for wxGTK/gtk1.2 & GNOME 1.0 / Debian Slink)
    - cut&paste (paste is there but broken in wxGTK)
  done:
    x- reset scrollbars on Clear()
    x- add setting of background colour and/or image
    x- composeview: after inserting text (reply), update scrollbars
    x- fix initial scrollbar sizes --> seems ok, what exactly is wrong?
    L- delete in empty line doesn't work

- do not redraw messageview if the message is the one currently being
  shown (DONE, better:)
  -- option to keep wxLayoutList around for reuse?

- when inserting filetype of unknown MIME type, prompt for it
- speed up copy mail to folder by cusing c-client functionality
- wxComposeView: if replying, only mark message as answered if reply
  got sent --> difficult
- possibly have a MIME types editor (similar to netscape's?)
- if time permits: vcard-import
- use mm_critical() and delay application exit if necessary
- add "double click to open" profile option support to folder list ctrl

**************** end of KB priorities :-) *********************

- change of settings in the msg view section of the options dlg should generate
  an event which would propagete to all open msg views.
- make [Apply] work too!

- when inserting filetype of unknown MIME type, prompt for it,
  possibly have a MIME types editor (similar to netscape's?)
- forward messsages as 7Bit, i.e. provide 7bit/8bit selection in
  SendMessageCC::AddPart()

- folder set message flag update hook takes too long for really large folders
   ==> code commented out in MailFolderCC.cpp

 - easy to implement but useful feature: "check for new mail now"

- delete temporary files (esp. from image conversion!)
  - easy: add support for email-to-fax gateway at www.tpc.int and
    their coverpage

 - document scripts in extra/scripts

 - somehow allow different configs for different hosts, maybe a
   [M/HOSTNAME/Profiles] section overriding [M/Profiles]?

 - toggle readonly status of mailboxes?

 - GUI problems:
  - folder tree control should (configurable on a per-folder basis)
    highlight and count the number of new messages
  - add "Inline" option for MIME popup on graphics
  - typing keys while M starts up can cause segfault (startup-splash
    event handling?)


- ADB:
  + make AdbEdit auto-generate a formatted name from first/family-name
    and prefix/title.
  + for names without entries, use the same method for name generation
    as ProvBBDB for consistency
  + add "add current address to ADB" to compose view
  + should be updated when new entries are created (can't be deleted from
    elsewhere for now...), add an event for this
  - can't open autocollect.adb in AdbEditor if already opened (can't reproduce
    any more)
  - add ADB support for $HOME/.mailrc
    ( lines: "alias john_doe  john@doe.com, second@xxx.uuu, ...")
  - fix remaining BBDB/ADB problems (low priority)

*********************************************************************
*** things to fix/implement next ***
*********************************************************************

- configuration dialog for columns in folderview
  + VZ: will do
- alternative treecontrol instead of listctrl for folderview

- use wxURL to retrieve remote configuration files and import them,
  maybe even retrieve files to use as folders or address books`?

- wxFolderCreateNotebook should be split into base class and 2 derivations:
  wxFolderCreateNotebook and wxFolderPropNotebook

- drag and drop of messages between folders
- Are wxConfig/Profile GetNextGroup()/GetFirstGroup()  thread-safe??
  I started marking possible problems for multi-threaded code with
  //FIXME:MT
  VZ: ok, I usually do it too (always) except for the "obvious" problems, e.g.
      usage of static vars. I always name them with "s_" prefix (for this
      reason too) so it should be quite easy to do a grep for them later
  - MT-problem: rfc822_extraheaders()
  - MT-problem: wxlparser export function uses static variable

- add "Send Digest"

- detect one's own messages (i.e. mark "Myself" in "From:" or, as XFMail
  does, mark "To: ..." in "From:" column for them) and optionally suppress them
  completely.

- add !(command) expansion to wxConfig, i.e.
  VAR=!(hostname):me would execute "hostname" and return "hydra.medieval.de:me"

- only quote the selected text in reply/forward if there is any selection
  (as in XFMail) - very handy

- Add the real folder create panel to the folder create notebook
- DND with gmc (dead easy, see dnd example :-) )


- announce M on bbdb mailing list

  + add Picture field to Adb
    VZ: what should it contain? a file name? ...let's do this later
  + implement "internal clipboard" for
    - cut-&-paste
    - drag-&-drop

  + some fields are sometimes created disabled under Windows - very mysterious...

- UI things
  + we should somehow merge the toolbars into the main frame toolbar if it
    shows the folder view, for example
  + session management

- Python
  + fix Python problems -- what's wrong? No idea why Setup.py doesn't work.
  + add remaining (important) interface definitions
  + user/global Minit files, security issues
  + add OnNewMail callback by counting messages in mailbox
    + add sample callback showing new messages
  + merge in wxPython

- find a way to run stripwxhelpids from Manual automatically

*** to implement in near future ***

- event subsystem
  + write some macros for safe casting of the event param in the handlers to
    the correct type
  + separate "folder tree change" event in "pre" and "post" kind
  + maybe introduce return values?

- news reader functions
  + get the list of newsgroup and allow to choose from them
  + propose to get only some articles when there are more than some number of
    them (opening a never-read newsgroup takes _ages_)
  + "catch up" command
  + filtering of cross posted articles - would be very nice if this could be
    also used to filter the copies of received mail messages (i.e. if a
    message is sent to the mailing list and cc'd to me I'd like to read it
    only once)
  + "killfile" features and a special "quick kill" (TM) feature which would kill
    all articles of the author of the selected one

- Use configure to check for utilities, like help browser. "ReConfigure" menu.

- Edit-CC, CC messages to others but edit the individual copies before sending

- SendMessageCC should derive from a SendMessage abc

- threading of messages via MessageId/References header lines
  Follow examples in SunExpert journal.

- "Power Search": search all (even compressed?) folders for a keyword
  and when found, open the folder and display the message.

- Export and import of addressbook in text format.
  I'd like a feature to select fields from the addressbook and write
  them, e.g. semicolon separated as a list to a file, so one could
  parse them in scripts or whatever else.

- message integrity verification support
  + PGP
  + MD5 (see RFC-1544 for details)

- REMOTE-CONTROL: add support for popping window open and reading a folder of one's choice
  (for being controlled from xbiff like programs)
  idea: listen() on a socket and write socket number to a file ~/.M/socket

********************* long-term projects ***********************

- Support for different charsets (Unicode/utf-7/8?)

- LDAP -- possibly using python ldap module or OpenLDAP.

- automatic (but optional) mail compactification (to save disk space)?
  -> this could be done using scripts?

- creation of separate index files for mail folders

- compressed mail folders

********************* targets for re-write **********************

- start multi-threading on separate branch

*********************************************************************
*** Fixed, to be tested:
*********************************************************************

*********************************************************************
*** Fixed and tested:
*********************************************************************
- when creating a newsgroup folder, subscribe to it, so it appears in .newsrc
- ReplyTo flag should work now
- Fix occacions "Sequence invalid" (when marking/replying message)
-  new mail dialog getting stuck?
- sometimes M is very slow sending a message, why? (was server)
- fix status flag indicators (N/U seem to be wrong)
  -> new messages are marked as N, when viewed, they change to U
- is leading * for NNTP folders a good idea? NO - why does PINE do it?
- add TO: field to folderview
- send new mail events again - why have they disappeared?
- new mail dialog shows empty folder name when more than one message
  has arrived
- Solaris: all helpers need absolute path or won't get found
- Proper NNTP support and POP3 fetch solution are the same thing:
  - Use mail_fetch_overview() and implement it on the MailFolder
    interface. Use that new function in wxFolderView::Update() to
    display header lines. For NNTP this will only list the messages
    which exist on the server and are unread (not deleted).
    Use this somehow to update the count of messages in the folder.
 - suspected bug in MEvent code causing lockups/endless memory allocation
 - sometimes mailfolders/messages seem empty
 - A problem with expunging message from MailFolderCC: as the messages
   are queued, they cause fetches of messages which no longer exist
   because the count has not yet been updated.
 - make Message use refcount
 - add message/move to folder
 - copying to other folder only writes headers, no content
 - allow '=' in urls and don't allow ' '
 - help fails to find copyright
 - .mo files should be found in M_BASEDIR/locale
 - toolbars need to be a bit higher
 - crash when switching off header display in messageview
 - forwarding message triggers assert in wxComposeView:119
 - password entry field needs to use password setting to hide text
 - add explaining texts to python dialog
 - Toolbar sizes are wrong. --> used ugly workaround in
                                wxMainFrame.cpp which works most of the time
                                Robert is aware of this.
 - set permissions for config files (passwords!) (This is done in Profile.cpp now
   but should really be in wxConfig code)
 - SentMessages folder sometimes looked up in wrong directory (seems ok)
 - SentMail folder looked up in wrong directory still and gets
   overwritten instead of appended to
 - funny: X-Face/X-Mailer headers get sent but don't appear in SentMail folder.
 - BBDB file format in read-only mode seems to work, needs a bit more
   testing, crashes are gone
 - BBDB save on exit, and parsing it in again
 - BBDB miniframe needs parent and text needs to move down
 - add explaining texts configuration panel  (return address, hostname)
 - add Statusbar to wxMessageView
 - deleting message ("Messsage|Delete") doesn't work
 - configuration panel got stuck on Solaris (usual constraints problem,
   goes away after resizing) -- (VZ) it happens to me under Linux too sometimes
   (occasional wxGTK bug?)
 - new "new mail" message seems to show wrong number
 - user name no longer contains additional fields
 - wxAboutDialog:
   + has extra wxYield() to improve display at startup
   + scrollbars should disappear now
 - deleting messages from wxMessageView doesn't work
 - wxLayout:
   + "Home" key is funny  (fixed)
   + some other keys are funny, too, ignore control characters
   + flicker is gone, scrollbars are fine
   + some more keyboard bindings (ctrl-u/k)
   + make it have a border (easy via offset!)
   + scrollbar settings  .. work perfectly fine for me
   + Delete() in wxLayoutList is broken (ctrl-y triggers it)
   + cursor corrupts last character
 - MFrame icon not found, compile it in. (lowercase?!)
 - strange lyx/latex problems (caused by % in rawhtml section)
 - toggle headers doesn't work
 - wxLayout
  + printing takes ages to find .afm files
  + does word wrap work?
  + cursor bitmap occasionally causes segfault in bitmap generation
    (odd dimensions?) (no longer used)
  + horizontal scrollbar doesn't jump to cursorpos when newline
  + "Home" key is funny  (fixed)
  + cursor movement must be displayed properly ( redraw function marked
    with //FIXME)
  + already faster, but could get even faster. Layout/Draw only parts of the list
 - wxllist::Delete() is almost surely broken, but behaves fine
 - treecontrol uses folder names starting with "/" which must not be passed
   to wxFolderView, etc. Folder names do not start with a slash, but are relative.
   Especially, "INBOX" != "/INBOX".
   I added a crude hack to wxMainFrame::OpenFolder() //FIXME
   and wxFolderTree.
 - documentation system should support pictures
 - wxComposeView::Print() fails, wxMessageView::Print() works, why?
  - add (simple) keyboard interface to folder view (?)
    (at least d,n,p or something like that)
 - forwarding messages broken, no content
 -   Currently, coying emails to another folder produces "New Mail" dialogs.
 - creating new folder and immediately after doing a message/copy to
   folder caused crash
 - when calling netscape to view URL, M locked up (after writing
   "done"), top showed two M processes and after a while it terminated
   with an IO trap
 - wxlwindow: MIME menu appears at wrong position again
 - make Message class use reference counting !
 - new mail dialog:
   + sometimes From: is empty
   + if more than one new mail, info for one of them is duplicated
   + apparently if mails have been deleted in the meantime, counter
     must be updated
 - wxLayout:
   + printing needs better scaling how does sample do it?
   + use smaller fonts for printing.
   \--> works well like now, but setting the printer scale smaller
        reduces page size, just rescale fonts instead
 - integrate new c-client lib 4.5
 - Profile readEntry() needs interface extension to allow a boolean success
   value, remove hacks like 17 or "illegal value"!
 - POP3: loading all message contents(why?) and twice(why?)
 wxFolderView:
 - clear MessageView, for this:
 - modify wxMessageView to only temporarily use Profile when needed, so
   it doesn't stay with the old folderview profile
 - investigate problem of empty message bodies (e.g. on Micky's mails
   from the Scottish Office).  SEEMS GONE!?
 - suspected bug in LoadImageXpm in wxIconmanager leading to crashes
 - wxListCtrl in folderview behaves properly now
 - could we have each flag at its own position in folder view listview? I.e.
   now they all appear in sequence and I'd like each of them have its own
   position (looks better and it becomes easier to spot, for example, all
   unread messages)
    KB: done that.
 - entry names containing "+" will get created and garbled/lost on
   re-load as they are illegal characters in wxConfig entry names
 + config entry names should allow  ',' (needed for mail names which
   might contain it, just received one from "john doe, archeology"),
   the same for apostrophes
DONE:

Add choice of intermediary image format:
  PNG, JPG, XPM
  --> prefer JPG, Imagemagick PNG support is faulty!
- If mail is from efax.com and contains an application/octet-stream,
  use tiff2ps and ghostview to generate an application/postscript
  instead. (Just convert the type to image/tiff-g3 and implement our
  own handler for that.)
  EFAX now sends image/tiff!
  Configurable! Options for tiff2ps!
  >>> Finish this: have share/M/mime.types with tiff2ps/gv combo
- .newsrc read/write  --> should be there?!
  For nntp folders, mark read messages as deleted. Somehow provide
  feedback! At close, ask whether to mark all messages as read.
  --> .newsrc does get updated! :-)

- check in new options panels
  - add help button in notebook, linked to help ids in panels

- when doing "select all", disable OnSelect() for folder listctrl


- Is this needed?
  And disable events!
  When doing a Delete() etc, do not rebuild the
  listing between, this corrupts message numbers!
  Find a clever way to handle this, build a sequence first!

- retrieve messages starting from last one
- fix bitmap allocation in SetBackgroundBitmap() calls (seems ok now)
 - save and restore printer settings in profile

- fix occasional segfault/memory corruption in MailfolderCC.cpp
   + this might have been caused by the bug with rfc822_extraheaders
     and be fixed now -- wait and see (seems gone, 22.3.99)
- add msgview.xpm icon to repository (forgot it at home)
- save and restore printer settings in profile

- folderview listctrl has extra Subject column behind Size field ???
  Looks like a wxGTK bug that seems to have disappeared in the meantime.
  However, using ClearAll() instead of DeleteXXX() now to simplify
  things a bit.

- Modify MailFolder interface to take UIDs instead of listing indices
  everywhere. This is important for "Views" to be implemented.
  --> add test for validy of uid
- ISO8859 encoded message headers!

- the selection in wxFoldreview should store uids directly, currently
  the wxMessageview of a standalone viewer passes its msgno to some
  functions but msgnos might have changed in the meantime.
- Things like CopyMessagesToFolder need a return code indicating
  whether they were successful or not, otherwise MoveMessagesToFolder
  deletes them in any case. Trivial to add.
 --> Clicking ABORT doesn't return false!
- MessageCC::Addresses() returns empty name for Morten Poulson  WHY?
- add news posting
- forward messsages as 7Bit, i.e. provide 7bit/8bit selection in
  SendMessageCC::AddPart()
  done-->  // check whether enc8bit is needed or not
- support for local news spool
- gtk 1.2 support seems to work
- add -ljpeg to linker options and JPG as intermediary image format
- have a global "NewMail" folder setting and ensure its existence
- MessageCC::GetBody() can return with body/envelope == NULL if
  message no longer exists. Just got a crash in Refresh().
  Add a CHECK() wherever it is called.
- do wxImage changes affect list of available handlers, etc?
- suppress mm_log() checkpoint completed messages
- add URL highlight colour
- are mail contens exported/imported in wrong order in reply?
  attachments appear before text.

- MailFolderCC: keep m_MailStream around after error and mark dead
  stream otherwise, OR, really completely reopen the folder.
  Like it is now, MessageCC might access it.
- add support for POLLINCOMINGDELAY in preferences
  and threshold for progress dialog
- remove dialog box in MailFolderCC::Ping about reopening folder!!!
- filter messages in mm_log/mm_notify
- make mailfolders collectable:
  - have a "collect" flag
---> done, after merging of profile code, add support for building
     list of these folders and periodically checking them.
     TEST!!!!
- When mm_log reports a "Unexpected change", do a Ping(), trying to
  reopen the stream.
- update the list of folders to poll for new mail when the folder
  properties are changed, tricky.
  --> Just add MAppBase::AddIncomingFolder()/RemoveIncomingFolder()
      and keep a list of the folder names and MailFolder pointers.
      Regularly check the incoming folders for validity, i.e. Ping() them.
- locale not found
- MailFolderCC:
   -if mailfolder has been closed due to timeout, reopen it.
 - SendMessageCC: allow re-sending of aborted send, i.e. Send() called
                  more than once
- message status etc in title bar
- afm path in config
- NewMail folder INCOMING flag reset
- INBOX by default INCOMING
- printer settings seem to have no effect : are persistent, do they get used?
  -- no printout appears!
  -- afm path should be stored
   -- broken in wxGTK!!
- MFolder.i
- new mail dialog for "New Mail" folder!!!
- MailCollector: implement Add/Remove calls
- CHECK mailcollector for nntp: do mails get marked as read?
  ++ if necessary, reopen folder??
- copying message to non-existing folder gives error message but works

 vi: set si tw=80:
