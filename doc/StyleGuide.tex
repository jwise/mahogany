%% This LaTeX-file was created by <karsten> Sun Nov 22 20:18:56 1998
%% LyX 1.0 (C) 1995-1998 by Matthias Ettrich and the LyX Team

%% Do not edit this file unless you know what you are doing.
\documentclass[12pt]{article}
\usepackage[T1]{fontenc}
\usepackage{palatino}

\makeatletter


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
\newcommand{\LyX}{L\kern-.1667em\lower.25em\hbox{Y}\kern-.125emX\spacefactor1000}

\makeatother

\begin{document}


\title{C++ Coding Style Guide}


\author{Karsten Ballüder\\ (\texttt{Ballueder@usa.net,~http://Ballueder.home.ml.org})}

\maketitle
\begin{abstract}
This document is a set of notes explaining my preferred style of coding for
C++, as it should be used throughout M in order to avoid unnecessary reformatting
between different developers. The following guidelines have proven themselves
to be useful during several cross-platform projects.
\end{abstract}

\section{Preprocessor Usage}


\subsection{\#define's}


\subsubsection{Features and Compile time defines}

As most platforms use the GNU \texttt{configure} system to set defines, we have
to follow its way of doing things. Therefor all defines which enable or disable
features, should follow the following conventions:

\begin{enumerate}
\item If they define a compile time option, they should be called \texttt{USE\_XXX},
if they define the availability of something, they should be called \texttt{HAVE\_XXX}.
\item If defined, they must have the value 1. Never define it to be 0, but use \texttt{\#undef}
instead.
\item To test a define, do \textit{not} use \texttt{\#if}, but use \texttt{\#ifdef},
\texttt{\#if~defined()} or \texttt{\#ifndef} .
\item Try to reduce duplicate code in preprocessor dependent sources to avoid confusing
\texttt{DOC++}. I.e. do not repeat multiple class declarations, but keep only
one which changes depending on the predefined symbols. See section \ref{DOCXX}
for an example.
\end{enumerate}

\subsubsection{Operating system identifiers}

The source code must never reference any prdefined symbols such as \texttt{\_\_unix\_\_}
or \texttt{\_\_WINDOWS\_\_}. Instead, the global source configuration header
file should check for them and define appropriate \texttt{OS\_XX} values. Examples
are: \texttt{OS\_WIN}, \texttt{OS\_UNIX}, \texttt{OS\_LINUX}, \texttt{OS\_SOLARIS}.
Obviously, more than one of them can be defined at the same time, e.g. \texttt{OS\_UNIX}
and \texttt{OS\_SOLARIS}. Also, \texttt{OS\_POSIX} may be helpful. All of thes
are either defined to 1 or undefined.


\subsubsection{Compiler identifiers}

For identifying different compilers rules analog to operating systems hold.
I.e. there should be defines of the type \texttt{CC\_XXX} defined. So far, M
supports the following two compilers:

\begin{itemize}
\item GNU gcc: \texttt{CC\_GCC}, including egcs.
\item Microsoft Visual C++: \texttt{CC\_MSC}
\end{itemize}

\subsection{\#include's}


\subsubsection{precompiled headers}

To support precompiled headers and to avoid unnecessarily compiling headers
multiple times, one global header file \texttt{Mpch.h} exists and should be
used in the following way:

\begin{itemize}
\item On systems that support precompiled headers: it includes \texttt{Mconfig.h}
and all other header files which are used reasonably often.
\item On systems without precompiled headers, it only includes \texttt{Mconfig.h}.
\item On systems that support precompiled headers, the define \texttt{USE\_PCH} will
be defined.
\end{itemize}
All source files should include \texttt{Mpch.h}, all header files should include
\texttt{Mconfig.h}.


\subsection{Indentation}

\begin{itemize}
\item All preprocessor directives must start at column 0. Indentation should happen
between the leading hash (\#) and the directive.
\item Indentation is by a three spaces.
\item Between a \texttt{\#include} and the file name, there should be three spaces.
\end{itemize}
Example:

\verb|#ifdef OS_UNIX|

\verb|#        include <unistd.h>|

\verb|#endif|


\section{Naming conventions}


\subsection{General}

\begin{itemize}
\item Do not use names starting with underscores, like \texttt{\_malloc} or \texttt{\_\_malloc}.
\item Class names always start with capital letters, variable names start with lower
case letters, i.e. \texttt{MApplication} is a class name, \texttt{mApplication}
is a variable name.
\item Class method names are capitalised, i.e. \texttt{MyClass::MyMethod()}, but function
names always start with a lowercase letter, i.e. \texttt{void~exitFunc()}.
\item Do not use \texttt{hungarian} notation.
\item Do use the \texttt{m\_} prefix for member variables.
\item When using names consisting of several words, use mixed capitalisation, not
underscores, i.e. use \texttt{MyNewClass}, not \texttt{My\_new\_class}.
\item Avoid duplicating names of classes as variable names, i.e. \texttt{MApplication}
and \texttt{mApplication}, unless when there is only one instance of that class,
then it should be the same name, e.g. \texttt{MyApp~myApp;}.
\item Use \texttt{const} wherever possible, both for parameters and for methods.
\item Try to avoid templates.
\end{itemize}

\section{Formatting of C/C++ code}


\subsection{Rule of thumb}

Format your code like seen in Bjarne Stroustrup's \textit{The C++ Programming
Language.}


\subsection{Braces }

Braces should always be on a line by themselves. If following a control statement,
they should be on the same indentation level as that statement. E.g. the brace
after an \texttt{if()} statement should be directly under the ``\texttt{i}''

Do not write code like:

\verb|if(foo == bar) {| 

\verb| printf("foo is bar\n");|

but write

\verb|if(foo == bar)|

\verb|{|

\verb| printf("foo is bar\n");|


\subsection{Tabulators and Spaces}

To make cooperation easier we have agreed to \emph{not} to use any tabulator
characters in the sources. Instead three spaces should be used. The basic indentation
depth is three spaces per level.


\subsection{Comments}


\subsubsection{Comment markers}

Comments should be marked by \texttt{//} only if they are short. If they continue
over more than one line, they should be marked as C-style comments.


\subsubsection{FIXME comments}

To mark places in the source which need further attention or fixing, a comment
containing the word \texttt{FIXME} should be used.


\subsubsection{Use DOC++ comments}

\label{DOCXX} It's pretty buggy, but maybe some day there will be a working
version of it, so use it.


\paragraph{Avoid duplicate definitions or declarations in multiple branches of compilation:}

The following example confuses \texttt{DOC++}:

\verb|#ifdef XXX|

\verb|class Class : public class BaseClass|

\verb|#else|

\verb|class Class|

\verb|#endif|

Instead, use code like this:

\verb|class Class| 

\verb|#ifdef XXX|

\verb|: public class BaseClass|

\verb|#endif|


\section{Other coding issues}


\subsection{Local data}

Do not define arrays as local variables, but explicitly allocate and deallocate
them using \texttt{new~{[}{]}} and \texttt{delete~{[}{]}}. If defined as local
variables, they will get allocated on the stack which might overflow and produce
wrong results without any warnings, which is difficult to detect.


\subsection{Use prefixes in global names}

When defining macros or global variable names (In some cases, this should also
apply to class names.), use a library or application specific prefix to avoid
conflicts with symbols defined in other libraries. 

Example:

Do not define a global macro such as \texttt{SIZE(x)}, but call it \texttt{mylibSIZE(x)}
or \texttt{mSIZE(x)}.


\subsection{Version Control}

The sources are managed by the \texttt{CVS} version control system. For easy
identification, each file should start with a comment, including at least the
\texttt{\$Id$} and the \texttt{\$Log:~StyleGuide.lyx,v
\$Revision~1.9~~1998/11/22~19:48:36~~KBNew~documentation~generation~system.~Automatically
produces~PS,~HTML~and~wxhelp.map.Revision~1.8~~1998/08/16~16:32:16~~KBupdatesRevision
1.7~~1998/05/20~13:32:10~~KBEventually~fixed~that~Doc++~core~dump~problem~and
added~a~note~aboutthis~in~the~StyleGuide.Revision~1.6~~1998/05/14~18:49:07~~KBExtended
naming~conventions,~added~postscript~versions.Revision~1.5~~1998/05/02~18:29:51
~KBAfter~many~problems,~Python~integration~is~eventually~taking~off~-works.}
tags. Including the \texttt{\$Log$
tags. Including the \texttt{\Revision 1.4  1998/11/26 21:58:57  KB
tags. Including the \texttt{\trying to set up a python setup script
tags. Including the \texttt{\Revision~1.9~~1998/11/22
19:48:36~~KBNew~documentation~generation~system.~Automatically~produces~PS,
HTML~and~wxhelp.map.Revision~1.8~~1998/08/16~16:32:16~~KBupdatesRevision~1.7
~1998/05/20~13:32:10~~KBEventually~fixed~that~Doc++~core~dump~problem~and~added
a~note~aboutthis~in~the~StyleGuide.Revision~1.6~~1998/05/14~18:49:07~~KBExtended
naming~conventions,~added~postscript~versions.Revision~1.5~~1998/05/02~18:29:51
~KBAfter~many~problems,~Python~integration~is~eventually~taking~off~-works.}
information in each file somehow inflates the code, but as the CVS archive might
only be accessible through a dial-up internet connection, it provides valuable
information.

\end{document}
